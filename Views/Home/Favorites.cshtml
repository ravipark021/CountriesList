
<table id="tableData" class="table table-inverse">
  <thead>
    <tr>
      <th>Code</th>
      <th>Country Name</th>
      <th>Country Flag</th>
      <th>Country Capital</th>
      <th>Currency Rate</th>
      <th>Map</th>
      <th>Favorite</th>
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>
<div id="myDiv">
        <img id="loading-image" src="~/Images/ajax-loader.gif" style="display:none;"/>
    </div>
<script>
  $(document).ready(function(){
    $.ajax({
        type: 'GET',
        url: '@Url.Action("GetAllFavorites")',
        beforeSend: function() {
          $("#loading-image").show();
        },
        success: function (favorites) {
          console.log(favorites);
          var favoriteHtml = '';
          favorites.forEach(function(favorite){
            favoriteHtml += '<tr>'+
                  '<th id="country_code" scope="row">' + favorite["countryCode"] + '</th>'+
                  '<td id="country_name">' + favorite["countryName"] + '</td>'+
                  '<td id="country_flag"><img src=' + favorite["countryFlag"] + '></td>'+
                  '<td id="country_capital">' + favorite["countryCapital"] + '</td>'+
                  '<td id="country_rate">' + parseFloat(favorite["currencyValue"]).toFixed(2) + ' Indian rupee(s)</td>'+
                  '<td id="country_map">'+
                      '<div class="mapouter">'+
                        '<div class="gmap_canvas">'+
                            '<iframe width="150" height="150" id="gmap_canvas" src="' + favorite["countryMapURI"] + '" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>'+
                            '</div>'+
                        '<style>.mapouter{overflow:hidden;height:150px;width:150px;}.gmap_canvas {background:none!important;height:150px;width:150px;}</style>'+
                     '</div>'+
                  '</td>'+
                  '<td>';
            favoriteHtml += (favorite["isFavorite"] === "1") ? '<button type="button" id="unlike-button" class="btn btn-primary btn-lg btn-unlike">Liked</button>' 
                                    : '<button type="button" id="like-button" class="btn btn-primary btn-lg">Like</button>';
            favoriteHtml += '</td>'+
                '</tr>' 
          }); 
          $("#loading-image").hide();
          $('#tableData tbody').append(favoriteHtml);  
        },
        error: function (ex) {
            var r = jQuery.parseJSON(response.responseText);
            alert("Message: " + r.Message);
            alert("StackTrace: " + r.StackTrace);
            alert("ExceptionType: " + r.ExceptionType);
        }
    });
  });
  $(document).ajaxComplete(function(){
      $(".btn-unlike").click(function(event){
        console.log($(this).closest("tr"));
        $(this).closest("tr").fadeOut();   
        var countryName = $(this).closest("tr").children("td#country_name").html()
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '@Url.Action("ToggleLike")',
            data: {"isLiked": false, "countryName": countryName},
            success: function (data) {
                console.log(data);                 
            },
            error: function (ex) {
                var r = jQuery.parseJSON(response.responseText);
                alert("Message: " + r.Message);
                alert("StackTrace: " + r.StackTrace);
                alert("ExceptionType: " + r.ExceptionType);
            }
        });	
      });
  });
</script>